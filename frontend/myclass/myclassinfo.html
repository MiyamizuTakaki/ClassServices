<!DOCTYPE html>
<html lang="en">
<script src="js/jquery.min.js"></script>
<link href="css/bootstrap.min.css" rel="stylesheet">

<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.cookie.min.js"></script>
<script crossorigin="anonymous"
        integrity="sha384-qlmct0AOBiA2VPZkMY3+2WqkHtIQ9lSdAsAn5RUJD/3vA5MKDgSGcdmIv4ycVxyn"
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.3.0/jquery.form.min.js"></script>
<link href="/js/veritylogin.js" rel="stylesheet" type="text/css">
<style>
    .mt-0 {
        margin-top: 0 !important;
    }
</style>
<div class="container">
    <form action="/advsrch" id="userpass" method="post" name="userinfo">
        <label for="selectGroup">Групп №</label><select class="form-control form-control-placeholder" id="selectGroup">
        <option disabled hidden id="setgrp" selected value="-1">по умолчанию</option>
    </select>
        <label for="selectmGroup">М Групп №</label><select class="form-control form-control-placeholder"
                                                           id="selectmGroup">
        <option disabled hidden id="grpnor" selected value="0">0</option>
    </select>
        <label for="selectDay">日期</label><select class="form-control form-control-placeholder" id="selectDay">
        <option disabled hidden id="chse1" selected value="-1">выбор</option>
        <option style="color: black;" value="0">понедельник</option>
        <option style="color: black;" value="1">вторник</option>
        <option style="color: black;" value="2">среда</option>
        <option style="color: black;" value="3">четверг</option>
        <option style="color: black;" value="4">пятница</option>
        <option style="color: black;" value="4">суббота</option>
        <option style="color: black;" value="4">воскресенье</option>
    </select>
        <div>Раз в две недели</div>
        <label for="selectWeek"></label><select class="form-control form-control-placeholder" id="selectWeek">
        <option disabled hidden id="weks" selected value="-1">все</option>
        <option style="color: black;" value="0">все</option>
        <option style="color: black;" value="1">Нечетная неделя</option>
        <option style="color: black;" value="2">Двойная неделя</option>
    </select>
        <button class="btn btn-primary" id="classsearch" type="submit">查询</button>

    </form>


    <table class="table table-hover table-bordered">
        <thead>
        <tr>
            <td>№</td>
            <td>Номер группы</td>
            <td>название</td>
            <td>Время начала курса</td>
            <td>Время окончания курса</td>
            <td>мечто</td>
            <td>тип</td>
            <td>Имя учителя</td>
        </tr>
        </thead>
        <tbody id="mozhide">

        </tbody>
    </table>
</div>
<script>
    $(document).ready(function () {
        var sectotime = function (second) {
            hour = parseInt(second / 3600)
            if (second % 3600 === 0)
                return hour + ":00:00";
            else {
                minutes = second % 3600 / 60;
                if (second % 3600 % 60 === 0) {
                    return hour.toString() + ":" + minutes.toString() + ":" + (second % 3600 % 60).toString();
                }
                return hour.toString() + ":" + minutes.toString() + ":00";
            }
        }
        String.prototype.format = function () {
            var formatted = this;
            for (var arg in arguments) {
                formatted = formatted.replace("{" + arg + "}", arguments[arg]);
            }
            return formatted;
        };
        token = $.cookie('users_token')
        console.log(token)
        $.post("/getcourse", {
                users_token: token
            },
            function (detail) {
                console.log(detail)
                var mmdd = new Date();
                var dates = mmdd.getDay();
                var lists = 0;
                // for(var j =0;i<detail.length;i++){
                //
                //    }
            })
        $.post("/infos", {
                users_token: token
            },
            function (detail) {
                console.log(detail)
                console.log("detail")
                var mmdd = new Date();
                var dates = mmdd.getDay();
                var lists = 0;
                if (detail["code"] === 1) {
                    $("#setgrp").text(detail["groups"])
                    var listgrp = detail["groups"].split(",")
                    var into = '<option value={0} style=\"color: black;\">全部</option>'.format(1)
                    $("#selectGroup").append(into);
                    for (var i = 0; i < listgrp.length; i++) {
                        into = '<option value={0} style=\"color: black;\">{1}</option>'.format(i + 1, listgrp[i])

                        $("#selectGroup").append(into);
                    }
                }
            })
        $("#chse1").text(function getDataWeek() {
            var today = ['воскресенье', 'понедельник', 'вторник', 'среда', 'четверг', 'пятница', 'суббота'];
            var tdynum = [0, 1, 2, 3, 4, 5, 6]
            var mmdd = new Date();
            return today[mmdd.getDay()];
        })
        $("#weks").text(function getDataWeek() {
            var tdynum = [0, 1, 2, 3, 4, 5, 6]
            var mmdd = new Date();
            var dsz = Math.floor((mmdd.getTime() / 60 / 60 / 24 / 365 / 7) % 2 + 1)
            if (dsz === 1) {
                return "Нечетная неделя"
            } else {
                return "Двойная неделя"
            }

        })
        $(function () {
            $("#classsearch").click(function (event) {
                var formData = {
                    grps: $("#selectGroup option:selected").text(),
                    mgrp: $("#selectmGroup option:selected").text(),
                    date: $("#selectDay option:selected").val(),
                    week: $("#selectWeek option:selected").val()
                };
                if ($("#selectGroup option:selected").val() === -1 || $("#selectGroup option:selected").val() === 0) {
                    formData["grps"] = "all";
                }
                $.ajax({
                    type: "POST",
                    url: "/advsrch",
                    data: formData,
                    encode: true,
                }).done(function (data) {
                    $("#mozhide").empty();
                    console.log(data);
                    var lengths = 0;
                    for (var ds in data) {
                        lengths++;
                    }
                    if (lengths === 0)
                        alert("Никакого курса！")
                    for (var i = 0; i < lengths; i++) {
                        console.log(sectotime(data[i]["starttime"]))
                        var intoe = '<tr>\n' +
                            '            <td>' + i + '</td>\n' +
                            '            <td>' + data[i]["groupint"] + '</td>\n' +
                            '            <td>' + data[i]["names"] + '</td>\n' +
                            '            <td>' + sectotime(data[i]["starttime"]) + '</td>\n' +
                            '            <td>' + sectotime(data[i]["endtime"]) + '</td>\n' +
                            '            <td>' + data[i]["address"] + '</td>\n' +
                            '            <td>' + data[i]["type"] + '</td>\n' +
                            '            <td>' + data[i]["teacher"] + '</td>\n' +
                            '        </tr>'
                        $("#mozhide").append(intoe);
                    }
                });
                event.preventDefault();

            });
        })

    })

</script>

</html>