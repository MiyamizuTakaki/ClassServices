<html lang="en">
<head>
    <script src="/js/jquery.cookie.min.js"></script>
    <!--    <script src="/js/jquery.datetimepicker.full.js"></script>-->
    <!--    <script type="text/javascript" src="/js/jquery.datetimepicker.full.js"></script>-->
    <meta charset="UTF-8">
    <link href="/css/normalform.css" rel="stylesheet" type="text/css">
    <link href="/js/veritylogin.js" rel="stylesheet" type="text/css">
    <link href="/css/bootstrap-table.min.css" rel="stylesheet">
    <script src="/js/bootstrap-table.min.js"></script>
    <!--    <link href="/css/bootstrap-datetimepicker.min.css" media="screen" rel="stylesheet"/>-->

    <!--<script src="/js/navgeter.js" type="application/javascript"></script>-->
    <title>Мое расписание</title>
</head>
<div class="container">
    <div class="row">
        <div class="col-8">Управление пользователями</div>
        <div class="col-1">
            <button class="btn btn-primary" data-target="#myModal" data-toggle="modal" id="adduser" type="button">
                Создать пользователя
            </button>
        </div>
    </div>
    <div class="row">
        <div class="col-4">
            <label for="selectDay">Критерии фильтрации</label><select class="form-control form-control-placeholder"
                                                                      id="selectDay">
            <option disabled hidden id="chse1" selected value="-1">Выбрать все</option>
            <option style="color: black;" value="-1">Выбрать все</option>
            <option style="color: black;" value="0">имя</option>
            <option style="color: black;" value="1">номер</option>
            <option style="color: black;" value="2">дата рождения</option>
            <option style="color: black;" value="3">Номер группы</option>
            <option style="color: black;" value="4">Название отдела</option>
        </select>
        </div>
        <div class="col-4"><label>Критерии фильтрации</label>

            <input class="form-control" id="textinfo" placeholder="содержание" type="text"></div>
        <div class="col-4">
            <div class="col-4"><label>А потом просто</label>
                <button class="btn btn-primary" data-dismiss="modal" id="pwduser">поиск</button>
            </div>
        </div>
    </div>
    <div id="magerinfo">
        <table class="table table-hover" id="mytab"></table>
    </div>
    <div class="modal fade" id="myModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- 模态框头部 -->
                <div class="modal-header">
                    <h4 class="modal-title">Создать пользователя</h4>
                    <button class="close" data-dismiss="modal" type="button">&times;</button>
                </div>
                <form>
                    <!-- 模态框主体 -->
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="ids">серийный номер</label>
                            <input class="form-control" id="ids" type="text">
                        </div>
                        <div class="form-group">
                            <label for="names">имя пользователя</label>
                            <input class="form-control" id="names" type="text">
                        </div>
                        <div class="form-group">
                            <label for="usr">Псевдоним пользователя</label>
                            <input class="form-control" id="usr" type="text">
                        </div>
                        <div class="form-group">
                            <label for="pwd">Палочь:</label>
                            <input class="form-control" id="pwd" type="password">
                        </div>
                        <div class="form-group">
                            <label for="email">электронная почта</label>
                            <input class="form-control" id="email" type="email">
                        </div>
                        <div class="form-group">
                            <label for="phone">телефона</label>
                            <input class="form-control" id="phone" type="text">
                        </div>
                        <div class="form-group">
                            <label for="factname">Кафедра факультетов</label>
                            <select class="form-control form-control-placeholder"
                                    id="factname">
                                <option disabled hidden id="none1" selected value="-1">Не выбран</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="grp">Номер отдела</label>
                            <select class="form-control form-control-placeholder"
                                    id="grp">
                                <!--                                <option disabled hidden id="none" selected value="-1">全选</option>-->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="mgrp">Номер группы</label>
                            <select class="form-control form-control-placeholder"
                                    id="mgrp">
                                <!--                                <option disabled hidden id="none2" selected value="-1">全选</option>-->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="birthDate">Твой день рождения</label>
                            <input class="form-control" id="birthDate" type="date"/>
                        </div>
                        <div class="form-group">
                            <label for="startDate">Дата начала обучения</label>
                            <input class="form-control" id="startDate" type="date" value=""/>
                        </div>
                        <div class="form-group">
                            <label for="endDate">Дата окончания обучения</label>
                            <input class="form-control" id="endDate" type="date" value=""/>
                        </div>
                    </div>
                    <!-- 模态框底部 -->
                    <div class="modal-footer">
                        <button class="btn btn-primary " data-dismiss="modal" type="submit" id="addinfo">передавать
                        </button>
                        <button class="btn btn-secondary" data-dismiss="modal" type="button">закрывать</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    var inf = {
        url: '/getuser?ptr=-1',
        method: 'get',
        toolbar: "#toolbar",
        sidePagination: "client",
        striped: true, // 是否显示行间隔色
        search: "false",
        uniqueId: "ID",
        pageSize: "5",
        pagination: true, // 是否分页
        sortable: true, // 是否启用排序
        columns: [{
            field: 'id',
            title: 'Идентификационный номер'
        },
            {
                field: 'name',
                title: 'имя'
            },
            {
                field: 'nickname',
                title: 'Ник пользователя'
            },
            {
                field: 'facid',
                title: 'Номер курса'
            },
            {
                field: 'mfacid',
                title: 'Номер группы'
            },
            {
                field: 'price',
                title: 'роль'
            },
            {
                field: 'clsnumber',
                title: 'Номер курса'
            },
            {
                field: 'fakt',
                title: 'Кафедра'
            },
            {
                field: 'date',
                title: 'дата рождения'
            },
            {
                field: 'phone',
                title: 'номер телефона'
            },
            {
                field: 'email',
                title: 'электронная почта'
            },
            {
                field: 'ststu',
                title: 'Дата начала обучения'
            },
            {
                field: 'endstu',
                title: 'Дата окончания исследования'
            },
            {
                field: 'price',
                title: 'работать',
                width: 120,
                align: 'center',
                valign: 'middle',
                formatter: actionFormatter,
            },
        ]
    }
    $('#mytab').bootstrapTable(inf);
    String.prototype.format = function () {
            var formatted = this;
            for (var arg in arguments) {
                formatted = formatted.replace("{" + arg + "}", arguments[arg]);
            }
            return formatted;
        };
    function actionFormatter(value, row, index) {
        var id = value;
        var result = "";
        result += '<button id="{0}" class="btn btn-info btn-sm get" data-toggle="modal" data-target="#editModal">редактор</button>'.format(row.id);
        result += '<button id="{0}" class="btn btn-danger btn-sm" style="margin-left:10px;">удалить</button>'.format(row.id);
        return result;
    }

    function unique(arr) {
        return Array.from(new Set(arr))
    }

    $(document).ready(function () {
        var list = [];
        var listfacn = [];
        var num;
        var tableinfo = {
                url: '/getuser',
                method: 'post',
                queryParamsType: '',
                queryParams: function(params) {
                return {
                    ptr: $.trim($("#selectDay").val()),
                    info: $.trim($("#textinfo").val())
                }
            },
                toolbar: "#toolbar",
                sidePagination: "client",
                striped: true, // 是否显示行间隔色
                search: "true",
                uniqueId: "ID",
                pageSize: "5",
                pagination: true, // 是否分页
                sortable: true, // 是否启用排序
                columns: [{
                    field: 'id',
                    title: 'Идентификационный номер'
                },
                    {
                        field: 'name',
                        title: 'полное имя'
                    },
                    {
                        field: 'nickname',
                        title: 'Ник пользователя'
                    },
                    {
                        field: 'facid',
                        title: 'Номер курса'
                    },
                    {
                        field: 'mfacid',
                        title: 'Номер группы'
                    },
                    {
                        field: 'price',
                        title: 'роль'
                    },
                    {
                        field: 'clsnumber',
                        title: 'Номер курса'
                    },
                    {
                        field: 'fakt',
                        title: 'Кафедра'
                    },
                    {
                        field: 'date',
                        title: 'дата рождения'
                    },
                    {
                        field: 'phone',
                        title: 'номер телефона'
                    },
                    {
                        field: 'email',
                        title: 'электронная почта'
                    },
                    {
                        field: 'ststu',
                        title: 'Дата начала обучения'
                    },
                    {
                        field: 'endstu',
                        title: 'Дата окончания исследования'
                    },
                    {
                        field: 'price',
                        title: 'работать',
                        width: 120,
                        align: 'center',
                        valign: 'middle',
                        formatter: actionFormatter,
                    },
                ]
            }
        $("#adduser").click(function () {
            token = $.cookie('users_token');
            $.post("/getallinfo",
                {
                    users_token: token
                },
                function (detail, status) {
                    //console.log(detail)
                    for (var q = 0; q < detail.length; q++) {
                        list.push(detail[q])
                        listfacn.push(list[q]["Faculy"])
                    }
                    listfacn = unique(listfacn)
                    for (var q = 0; q < listfacn.length; q++) {
                        $("#factname").append("<option style=\"color: black;\" value=\"" + (q + 1) + "\">" + listfacn[q] + "</option>");
                    }
                });
        })
        $("#factname").on("change", function () {
            $("#grp").empty();
            var options = $('#factname option:selected')
            for (var i = 0; i < list.length; i++) {
                if (options.text() == list[i]["Faculy"])
                    $("#grp").append("<option style=\"color: black;\" value=\"" + list[i]["grpnum"] + "\">" + list[i]["grpnum"] + "</option>")
            }
            var options = $('#grp option:selected')
            var statime;
            var endtime;
            for (var i = 0; i < list.length; i++) {
                if (options.val() == list[i]["grpnum"]) {
                    statime = list[i]["ststime"]
                    endtime = list[i]["enddtime"]
                }
            }
            startDate.value = statime
            endDate.value = endtime
        })
        $("#grp").on("change", function () {
            var statime;
            var endtime;
            for (var i = 0; i < list.length; i++) {
                if ($(this).val() == list[i]["grpnum"]) {
                    statime = list[i]["ststime"]
                    endtime = list[i]["enddtime"]
                    num = list[i]["studnum"]
                }
            }
            startDate.value = statime
            endDate.value = endtime
            $("#mgrp").empty()
            console.log(parseInt(num))
            for (var i = 0; i < parseInt(num) + 1; i++)
                $("#mgrp").append("<option style=\"color: black;\" value=\"" + i + "\">" + i + "</option>")
        })
        $("#pwduser").click(function () {
            var dta = {ptr: $("#selectDay").val(), info: $("#textinfo").val()}
            $('#mytab').bootstrapTable('destroy');
            $('#mytab').bootstrapTable(tableinfo);

            function queryParams(params) {
                return {
                    ptr: $.trim($("#selectDay").val()),
                    info: $.trim($("#textinfo").val())
                }
            }
        })
        $("#addinfo").click(function () {
            var options = $('#factname option:selected')
            token = $.cookie('users_token')
            var formData = {
                id: $("#ids").val(),
                users_token: token,
                names: $("#names").val(),
                usr: $("#usr").val(),
                pwd: $("#pwd").val(),
                email: $("#email").val(),
                phone: $("#phone").val(),
                factname: options.text(),
                grp: $("#grp").val(),
                mgrp: $("#mgrp").val(),
                birthDate: $("#birthDate").val(),
                startDate: $("#startDate").val(),
                endDate: $("#endDate").val(),
            }
            $.ajax({
                type: "POST",
                url: "/adduser",
                data: formData,
                encode: true,
            }).done()
        })
        $(".get").bind("click",function (){
            var id=$(this).attr('id');

        })
    })

</script>
</html>